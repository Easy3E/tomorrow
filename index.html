<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tomorrow App</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide icons as SVG components
        const Clock = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12,6 12,12 16,14"/>
            </svg>
        );

        const Award = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="8" r="6"/>
                <path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/>
            </svg>
        );

        const Flame = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/>
            </svg>
        );

        const User = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
            </svg>
        );

        const Crown = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M11.562 3.266a.5.5 0 0 1 .876 0L14.663 8.5l4.553-.889a.5.5 0 0 1 .514.85L17.5 11.5 20.73 16.73a.5.5 0 0 1-.208.756L12 21l-8.522-3.514a.5.5 0 0 1-.208-.756L6.5 11.5 4.27 8.461a.5.5 0 0 1 .514-.85L9.337 8.5l2.225-5.234Z"/>
            </svg>
        );

        const Star = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/>
            </svg>
        );

        const Tomorrow = () => {
            // State management
            const [phase, setPhase] = useState('input');
            const [answer, setAnswer] = useState('');
            const [savedAnswer, setSavedAnswer] = useState('');
            const [timeRemaining, setTimeRemaining] = useState(0);
            const [streakCount, setStreakCount] = useState(0);
            const [streakFreezes, setStreakFreezes] = useState(0);
            const [lastSubmissionTime, setLastSubmissionTime] = useState(null);
            const [showStreakFreezePopup, setShowStreakFreezePopup] = useState(false);
            const [showAccessoryPopup, setShowAccessoryPopup] = useState(false);
            const [newAccessory, setNewAccessory] = useState('');
            const [unlockedAccessories, setUnlockedAccessories] = useState([]);
            const [avatarColor, setAvatarColor] = useState('#3B82F6');
            const [showAvatarCustomizer, setShowAvatarCustomizer] = useState(false);

            // Avatar accessories system
            const accessories = {
                crown: { name: 'Crown', icon: Crown, requirement: 5, color: '#FFD700' },
                star: { name: 'Star Badge', icon: Star, requirement: 8, color: '#FFA500' },
                flame: { name: 'Fire Aura', icon: Flame, requirement: 15, color: '#FF4500' },
                award: { name: 'Achievement Medal', icon: Award, requirement: 30, color: '#C0C0C0' }
            };

            const avatarColors = [
                '#3B82F6', '#10B981', '#F59E0B', '#EF4444', 
                '#8B5CF6', '#EC4899', '#06B6D4', '#84CC16'
            ];

            // Save data to localStorage
            const saveData = () => {
                const data = {
                    phase,
                    savedAnswer,
                    streakCount,
                    streakFreezes,
                    lastSubmissionTime,
                    unlockedAccessories,
                    avatarColor
                };
                localStorage.setItem('tomorrowAppData', JSON.stringify(data));
            };

            // Load data from localStorage
            const loadData = () => {
                try {
                    const saved = localStorage.getItem('tomorrowAppData');
                    if (saved) {
                        const data = JSON.parse(saved);
                        setPhase(data.phase || 'input');
                        setSavedAnswer(data.savedAnswer || '');
                        setStreakCount(data.streakCount || 0);
                        setStreakFreezes(data.streakFreezes || 0);
                        setLastSubmissionTime(data.lastSubmissionTime || null);
                        setUnlockedAccessories(data.unlockedAccessories || []);
                        setAvatarColor(data.avatarColor || '#3B82F6');
                        return data;
                    }
                } catch (error) {
                    console.log('Error loading data:', error);
                }
                return null;
            };

            // Get time until next midnight
            const getTimeUntilMidnight = () => {
                const now = new Date();
                const midnight = new Date();
                midnight.setDate(now.getDate() + 1);
                midnight.setHours(0, 0, 0, 0);
                return midnight.getTime() - now.getTime();
            };

            // Check if it's a new day since last submission
            const isNewDay = (lastTime) => {
                if (!lastTime) return false;
                const lastDate = new Date(lastTime);
                const today = new Date();
                
                lastDate.setHours(0, 0, 0, 0);
                today.setHours(0, 0, 0, 0);
                
                return today.getTime() > lastDate.getTime();
            };

            // Check if streak should be broken
            const checkStreakExpiry = (loadedData) => {
                const currentPhase = loadedData?.phase || phase;
                const currentLastSubmission = loadedData?.lastSubmissionTime || lastSubmissionTime;
                const currentStreakFreezes = loadedData?.streakFreezes || streakFreezes;
                
                if (!currentLastSubmission || currentPhase !== 'complete') return;
                
                const daysSinceSubmission = Math.floor((Date.now() - currentLastSubmission) / (24 * 60 * 60 * 1000));
                
                if (daysSinceSubmission > 1) {
                    if (currentStreakFreezes > 0) {
                        setStreakFreezes(prev => prev - 1);
                        alert('Streak freeze used automatically! Your streak is protected.');
                    } else {
                        setStreakCount(0);
                        alert('Streak lost! You missed completing yesterday\'s commitment.');
                    }
                    setPhase('input');
                    setSavedAnswer('');
                    setLastSubmissionTime(null);
                }
            };

            // Check for new accessories
            const checkNewAccessories = (newStreakCount) => {
                Object.entries(accessories).forEach(([key, accessory]) => {
                    if (newStreakCount === accessory.requirement && !unlockedAccessories.includes(key)) {
                        setUnlockedAccessories(prev => [...prev, key]);
                        setNewAccessory(accessory.name);
                        setShowAccessoryPopup(true);
                    }
                });
            };

            // Load data and check state on mount
            useEffect(() => {
                const loadedData = loadData();
                
                setTimeout(() => {
                    checkStreakExpiry(loadedData);
                    
                    const currentPhase = loadedData?.phase || phase;
                    const currentLastSubmission = loadedData?.lastSubmissionTime || lastSubmissionTime;
                    
                    if (currentPhase === 'waiting') {
                        if (isNewDay(currentLastSubmission)) {
                            setPhase('complete');
                        } else {
                            setTimeRemaining(getTimeUntilMidnight());
                        }
                    }
                }, 100);
            }, []);

            // Save data whenever state changes
            useEffect(() => {
                saveData();
            }, [phase, savedAnswer, streakCount, streakFreezes, lastSubmissionTime, unlockedAccessories, avatarColor]);

            // Timer effect for countdown to midnight
            useEffect(() => {
                let interval;
                if (phase === 'waiting' && timeRemaining > 0) {
                    interval = setInterval(() => {
                        const newTimeRemaining = getTimeUntilMidnight();
                        setTimeRemaining(newTimeRemaining);
                        
                        if (newTimeRemaining <= 0 || isNewDay(lastSubmissionTime)) {
                            setPhase('complete');
                        }
                    }, 1000);
                }
                return () => clearInterval(interval);
            }, [phase, timeRemaining, lastSubmissionTime]);

            // Format time for display
            const formatTime = (ms) => {
                const seconds = Math.ceil(ms / 1000);
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = seconds % 60;
                
                if (hours > 0) {
                    return `${hours}h ${minutes}m ${secs}s`;
                } else if (minutes > 0) {
                    return `${minutes}m ${secs}s`;
                } else {
                    return `${secs}s`;
                }
            };

            // Handle submission
            const handleSubmit = () => {
                if (answer.trim()) {
                    setSavedAnswer(answer.trim());
                    setAnswer('');
                    setLastSubmissionTime(Date.now());
                    setTimeRemaining(getTimeUntilMidnight());
                    setPhase('waiting');
                }
            };

            // Handle completion
            const handleComplete = () => {
                setStreakCount(prev => {
                    const newStreak = prev + 1;
                    
                    if (newStreak % 3 === 0) {
                        setStreakFreezes(freezes => freezes + 1);
                        setShowStreakFreezePopup(true);
                    }
                    
                    checkNewAccessories(newStreak);
                    
                    return newStreak;
                });

                setPhase('input');
                setSavedAnswer('');
                setLastSubmissionTime(null);
                setTimeRemaining(0);
            };

            // Use streak freeze
            const useStreakFreeze = () => {
                if (streakFreezes > 0) {
                    setStreakFreezes(prev => prev - 1);
                    alert('Streak freeze used! Your streak is protected.');
                }
            };

            // Avatar component
            const Avatar = () => (
                React.createElement('div', { className: 'relative' },
                    React.createElement('div', {
                        className: 'w-16 h-16 rounded-full flex items-center justify-center border-4 border-gray-200 cursor-pointer',
                        style: { backgroundColor: avatarColor },
                        onClick: () => setShowAvatarCustomizer(true)
                    },
                        React.createElement(User, { className: 'w-8 h-8 text-white' })
                    ),
                    unlockedAccessories.map((accessoryKey, index) => {
                        const Accessory = accessories[accessoryKey].icon;
                        const color = accessories[accessoryKey].color;
                        return React.createElement(Accessory, {
                            key: accessoryKey,
                            className: 'absolute w-4 h-4',
                            style: { 
                                color,
                                top: `${-2 + index * 8}px`,
                                right: `${-2 + index * 8}px`
                            }
                        });
                    })
                )
            );

            return React.createElement('div', { className: 'min-h-screen bg-white flex items-center justify-center p-4' },
                // Popups
                showStreakFreezePopup && React.createElement('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4' },
                    React.createElement('div', { className: 'bg-white rounded-lg p-6 max-w-sm w-full text-center shadow-lg' },
                        React.createElement('div', { className: 'mb-4' },
                            React.createElement(Award, { className: 'w-12 h-12 text-blue-500 mx-auto mb-2' }),
                            React.createElement('h3', { className: 'text-xl font-semibold text-gray-900' }, 'Streak Freeze Earned!')
                        ),
                        React.createElement('p', { className: 'text-gray-600 mb-4' },
                            'You\'ve completed 3 days in a row and earned a streak freeze! Use it to protect your streak if you miss a day.'
                        ),
                        React.createElement('button', {
                            onClick: () => setShowStreakFreezePopup(false),
                            className: 'bg-blue-500 text-white py-2 px-6 rounded-lg hover:bg-blue-600 transition-colors'
                        }, 'Awesome!')
                    )
                ),

                showAccessoryPopup && React.createElement('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4' },
                    React.createElement('div', { className: 'bg-white rounded-lg p-6 max-w-sm w-full text-center shadow-lg' },
                        React.createElement('div', { className: 'mb-4' },
                            React.createElement('div', { className: 'w-12 h-12 mx-auto mb-2 flex items-center justify-center' },
                                Object.entries(accessories).map(([key, acc]) => {
                                    if (acc.name === newAccessory) {
                                        const Icon = acc.icon;
                                        return React.createElement(Icon, { key, className: 'w-12 h-12', style: { color: acc.color } });
                                    }
                                    return null;
                                })
                            ),
                            React.createElement('h3', { className: 'text-xl font-semibold text-gray-900' }, 'New Accessory Unlocked!')
                        ),
                        React.createElement('p', { className: 'text-gray-600 mb-4' },
                            `You earned the ${newAccessory} for reaching ${streakCount} days!`
                        ),
                        React.createElement('button', {
                            onClick: () => setShowAccessoryPopup(false),
                            className: 'bg-purple-500 text-white py-2 px-6 rounded-lg hover:bg-purple-600 transition-colors'
                        }, 'Cool!')
                    )
                ),

                showAvatarCustomizer && React.createElement('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4' },
                    React.createElement('div', { className: 'bg-white rounded-lg p-6 max-w-sm w-full text-center shadow-lg' },
                        React.createElement('h3', { className: 'text-xl font-semibold text-gray-900 mb-4' }, 'Customize Avatar'),
                        React.createElement('div', { className: 'flex justify-center mb-4' },
                            React.createElement(Avatar)
                        ),
                        React.createElement('p', { className: 'text-sm text-gray-600 mb-3' }, 'Choose a color:'),
                        React.createElement('div', { className: 'grid grid-cols-4 gap-2 mb-4' },
                            avatarColors.map(color =>
                                React.createElement('button', {
                                    key: color,
                                    className: `w-8 h-8 rounded-full border-2 ${avatarColor === color ? 'border-gray-800' : 'border-gray-300'}`,
                                    style: { backgroundColor: color },
                                    onClick: () => setAvatarColor(color)
                                })
                            )
                        ),
                        React.createElement('button', {
                            onClick: () => setShowAvatarCustomizer(false),
                            className: 'bg-blue-500 text-white py-2 px-6 rounded-lg hover:bg-blue-600 transition-colors'
                        }, 'Done')
                    )
                ),

                // Main content
                React.createElement('div', { className: 'w-full max-w-md' },
                    // Header
                    React.createElement('div', { className: 'text-center mb-8' },
                        React.createElement('div', { className: 'flex justify-center mb-4' },
                            React.createElement(Avatar)
                        ),
                        React.createElement('h1', { className: 'text-3xl font-light text-gray-900 mb-4' }, 'Tomorrow'),
                        React.createElement('div', { className: 'flex items-center justify-center space-x-6 text-sm text-gray-600' },
                            React.createElement('div', { className: 'flex items-center space-x-1' },
                                React.createElement(Flame, { className: 'w-4 h-4 text-orange-500' }),
                                React.createElement('span', null, `${streakCount} day streak`)
                            ),
                            streakFreezes > 0 && React.createElement('div', { className: 'flex items-center space-x-1' },
                                React.createElement(Award, { className: 'w-4 h-4 text-blue-500' }),
                                React.createElement('span', null, `${streakFreezes} freeze${streakFreezes > 1 ? 's' : ''}`)
                            )
                        ),
                        Object.entries(accessories).some(([key, acc]) => !unlockedAccessories.includes(key) && streakCount < acc.requirement + 5) &&
                        React.createElement('div', { className: 'mt-3 text-xs text-gray-500' },
                            React.createElement('p', null, `Next reward: ${Object.entries(accessories).find(([key, acc]) => !unlockedAccessories.includes(key) && streakCount < acc.requirement)?.[1]?.name} at ${Object.entries(accessories).find(([key, acc]) => !unlockedAccessories.includes(key) && streakCount < acc.requirement)?.[1]?.requirement} days`)
                        )
                    ),

                    // Phase content
                    phase === 'input' && React.createElement('div', { className: 'text-center' },
                        React.createElement('div', { className: 'space-y-6' },
                            React.createElement('div', null,
                                React.createElement('label', { className: 'block text-lg text-gray-700 mb-4' },
                                    'How will tomorrow be better?'
                                ),
                                React.createElement('textarea', {
                                    value: answer,
                                    onChange: (e) => setAnswer(e.target.value),
                                    className: 'w-full p-4 border border-gray-200 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent',
                                    rows: 4,
                                    placeholder: 'Type your answer here...',
                                    onKeyDown: (e) => {
                                        if (e.key === 'Enter' && !e.shiftKey) {
                                            e.preventDefault();
                                            handleSubmit();
                                        }
                                    }
                                })
                            ),
                            React.createElement('button', {
                                onClick: handleSubmit,
                                disabled: !answer.trim(),
                                className: 'w-full bg-blue-500 text-white py-3 px-6 rounded-lg hover:bg-blue-600 transition-colors font-medium disabled:bg-gray-300 disabled:cursor-not-allowed'
                            }, 'Submit')
                        )
                    ),

                    phase === 'waiting' && React.createElement('div', { className: 'text-center space-y-6' },
                        React.createElement('div', { className: 'flex items-center justify-center mb-4' },
                            React.createElement(Clock, { className: 'w-8 h-8 text-blue-500' })
                        ),
                        React.createElement('h2', { className: 'text-xl text-gray-700' }, 'Your answer is saved!'),
                        React.createElement('div', { className: 'text-3xl font-light text-gray-900' },
                            formatTime(timeRemaining)
                        ),
                        React.createElement('p', { className: 'text-gray-600' },
                            'Time until you can complete your commitment.'
                        ),
                        streakFreezes > 0 && React.createElement('button', {
                            onClick: useStreakFreeze,
                            className: 'mt-4 text-blue-500 hover:text-blue-600 text-sm underline'
                        }, `Use Streak Freeze (${streakFreezes} available)`)
                    ),

                    phase === 'complete' && React.createElement('div', { className: 'text-center space-y-6' },
                        React.createElement('h2', { className: 'text-xl text-gray-700 mb-4' }, 'Yesterday, you said:'),
                        React.createElement('div', { className: 'bg-gray-50 p-6 rounded-lg' },
                            React.createElement('p', { className: 'text-gray-900 italic text-lg' }, `"${savedAnswer}"`)
                        ),
                        React.createElement('p', { className: 'text-gray-600' },
                            'Did you make today better?'
                        ),
                        React.createElement('button', {
                            onClick: handleComplete,
                            className: 'w-full bg-green-500 text-white py-3 px-6 rounded-lg hover:bg-green-600 transition-colors font-medium'
                        }, 'Complete')
                    )
                )
            );
        };

        ReactDOM.render(React.createElement(Tomorrow), document.getElementById('root'));
    </script>
</body>
</html>